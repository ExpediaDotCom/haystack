language: node_js

sudo: required

node_js:
  - '8'

env:
  global:
    - CHANGE_MINIKUBE_NONE_USER=true
    - BRANCH=${TRAVIS_BRANCH}
    - TAG=${TRAVIS_TAG}
    - SHA=${TRAVIS_COMMIT}

before_script:
  - export TERRAFORM_VERSION=$(curl -s https://checkpoint-api.hashicorp.com/v1/check/terraform | sed -e "s/.*current_version...//" | sed -e "s/\".*//")
  - curl -Lo terraform.zip "https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_linux_amd64.zip"
  - unzip terraform.zip && rm -f terraform.zip && chmod +x terraform
  - mkdir -p ${HOME}/bin && export PATH=${PATH}:${HOME}/bin && mv terraform ${HOME}/bin/
  - terraform -v

# generate doc pages and move generated resources to out folder
script:
  - ./deployment/terraform/apply-compose.sh -r plan
  - git config --global user.email "absrivastava@users.noreply.github.com"
  - git config --global user.name "absrivastava"
  - echo "machine github.com login absrivastava password $GITHUB_TOKEN" > ~/.netrc
  - if ([ "$TRAVIS_BRANCH" == "master" ] && [ "$TRAVIS_PULL_REQUEST" == "false" ]) || [ -n "$TRAVIS_TAG" ]; then cd ./docsite && GIT_USER=$GITHUB_USER ./generate_docsite.sh; fi

notifications:
  email:
    - haystack-notifications@expedia.com
